{% extends 'base.html.twig' %}

{% block title %}**Post**{% endblock %}

{% block content %}
    <link rel="stylesheet" href="{{asset('css/cardPost.css')}}">
    <link rel="stylesheet" href="{{asset('css/font-awesome.css')}}">

    <div class="wrapper" >

        {% for post in posts %}
            <br>
            <div class="container">


            <div class="blog_post">
                <div class="img_pod">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRsY-URPHt28kwUo6IlZW_0P8_bQVvEQXRi4cOrs1EYa9q5IBeb4KPRlS5h6qOYCOpYtgU&usqp=CAU" alt="random image">
                </div>
                <div class="container_copy" id={{post.id}}>
                    <h5>{{ post.idUser.email}}</h5>

                    <h1>{{ post.datep ? post.datep|date('Y-m-d') : '' }}</h1>
                    <br>

                    <h3>{{ post.title }}</h3>
                    <br>

                    <p>{{ post.content }}</p>


                </div>
                <br>
                <br>


                <a class="btn btn-outline-info btn-sm" href="{{ path('app_post_showback', {'id': post.id}) }}">Detail</a>
                <button class="like__btn" onclick="clickede({{ post.id }},{{ post.idUser.idUser }})" >
                    <span id="icon"></span>
                    <span id="count">0</span> j'aime
                </button>
                <a href="{{ path('app_comment_index',{'id': post.id}) }}"class="btn btn-outline-success btn-sm"class="fa-solid fa-heart" >Commentaires</a>


            </div>
            </div>
        {% endfor%}
        <br>

    </div>

    <script >
        let clicked = false;

        function clickede(post,user) {
            var vote = new FormData();
            vote.append("voteType",1);
            vote.append("idUser",user);
            vote.append("id",post);


            fetch( `http://127.0.0.1:8000/vote/new`,{    method: "POST",
                body: vote,
            }).then(function (response) {
                // The API call was successful!
                console.log('success!', response);
            }).catch(function (err) {
                // There was an error
                console.warn('Something went wrong.', err);
            });
            console.log(post,"post")
            console.log(user,"user")

            clicked = true;
            likeIcon.innerHTML = `<i class="fa fa-heart"></i>`;
            count.textContent++;
        }
        const likeBtn = document.querySelector(".like__btn");
        console.log(likeBtn,"likebtn")
        let likeIcon = document.querySelector("#icon"),
            count = document.querySelector("#count");



        likeBtn.addEventListener("click", () => {
            if (!clicked) {
                fetch('http://127.0.0.1:8000/post/like?user=tim&age=44').then(function (response) {
                    // The API call was successful!
                    console.log('success!', response);
                }).catch(function (err) {
                    // There was an error
                    console.warn('Something went wrong.', err);
                });
                clicked = true;
                likeIcon.innerHTML = `<i class="fa fa-heart"></i>`;
                count.textContent++;
            } else {
                fetch('https://jsonplaceholder.typicode.com/posts').then(function (response) {
                    // The API call was successful!
                    console.log('success!', response);
                }).catch(function (err) {
                    // There was an error
                    console.warn('Something went wrong.', err);
                });
                clicked = false;
                likeIcon.innerHTML = `<i class="fa fa-heart"></i>`;
                count.textContent--;
            }
        });
    </script>
{% endblock  %}

